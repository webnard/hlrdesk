const PORT = require('system').env.PORT;
const BASE = 'http://127.0.0.1:' + PORT;
const SHOTS = 'tests/screenshots/';

casper.test.begin('back button should continue to show side bar', function(test) {
  this.options.viewportSize = {top: 0, left: 0, width: 1280, height: 720};
  this.start(BASE + '/logmein?as=prabbit')
  .thenOpen(BASE, function() {
    this.click('.lpanel.check-in');
  })
  .then(function() {
    this.waitFor(function(){return this.exists('#checked-out-items')}, function() {
      test.assertExists('#checked-out-items');
    });
  )
  .thenOpen('http://example.com')
  .then(function() {
    this.back();
  })
  .then(function() {
    this.capture(SHOTS + 'back-button-clicked.png');
    test.assertExists('#left_panel');
  })
  .then(function() {
    this.clear();
    test.done();
  })
  .run();
});
